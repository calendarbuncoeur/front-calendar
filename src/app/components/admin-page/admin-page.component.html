<!-- Affiche le formulaire de mot de passe si non authentifié -->
@if (!isAuthenticated()) {
<div class="p-4 flex items-center justify-center min-h-[calc(100vh-200px)]">
  <div class="w-full max-w-md bg-white rounded-xl shadow-lg p-6 sm:p-8">
    <h1 class="text-2xl font-bold mb-6 text-center">Accès administrateur</h1>
    <form (ngSubmit)="checkPassword()">
      <div class="mb-4">
        <mat-form-field class="w-full" appearance="fill">
          <mat-label>Mot de passe</mat-label>
          <input
            matInput
            type="password"
            [ngModel]="password()"
            (ngModelChange)="password.set($event)"
            name="password"
            required
          />
        </mat-form-field>
      </div>

      <button type="submit" mat-raised-button color="primary" [disabled]="isLoading()" class="w-full">
        @if (isLoading()) {
        <mat-spinner [diameter]="24" class="inline-block"></mat-spinner>
        } @else {
        <span>Valider</span>
        }
      </button>

      @if (errorMessage()) {
      <p class="mt-4 text-center text-red-500 font-semibold">{{ errorMessage() }}</p>
      }
    </form>
  </div>
</div>
}

<!-- Affiche la liste des inscrits si authentifié -->
@if (isAuthenticated()) {
<div class="w-full max-w-5xl mx-auto">
  <h1 class="text-3xl font-bold mb-6 text-center">Tableau de bord administrateur</h1>
  <mat-accordion multi>
      @for (eventGroup of registrations(); track eventGroup.eventId) {
      <mat-expansion-panel class="mb-4 shadow-lg rounded-xl">
        <mat-expansion-panel-header collapsedHeight="64px" expandedHeight="64px">
          <mat-panel-title class="flex justify-between items-center w-full">
            <div>
              <h2 class="text-xl font-semibold text-blue-600">{{ eventGroup.eventName }}</h2>
              <p class="text-sm text-gray-500">
                {{ eventGroup.eventDate | date : 'd MMMM y' : '' : 'fr' }}
              </p>
            </div>
            <div class="text-right">
              <span class="font-bold text-lg">{{ eventGroup.registrations.length }}</span>
              <span class="text-sm text-gray-600"> inscrits</span>
              <p class="text-xs text-gray-500">
                ({{ eventGroup.availableSlots }} places restantes)
              </p>
            </div>
          </mat-panel-title>
        </mat-expansion-panel-header>

        <!-- Contenu du panneau (tableau des inscrits) -->
        <div class="overflow-x-auto">
          <table mat-table [dataSource]="eventGroup.registrations" class="w-full">
            <!-- Colonnes du tableau -->
            <ng-container matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef> Nom </th>
              <td mat-cell *matCellDef="let reg"> {{reg.first_name}} {{reg.last_name}} </td>
            </ng-container>

            <ng-container matColumnDef="contact">
              <th mat-header-cell *matHeaderCellDef> Contact </th>
              <td mat-cell *matCellDef="let reg"> {{reg.email || reg.phone_number}} </td>
            </ng-container>

            <ng-container matColumnDef="date">
              <th mat-header-cell *matHeaderCellDef> Date d'inscription </th>
              <td mat-cell *matCellDef="let reg"> {{reg.created_at | date:'dd/MM/yy HH:mm':'':'fr'}} </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="['name', 'contact', 'date']"></tr>
            <tr mat-row *matRowDef="let row; columns: ['name', 'contact', 'date'];"></tr>
          </table>
        </div>
      </mat-expansion-panel>
      }
  </mat-accordion>
</div>
}
