<div class="container mx-auto p-4">
  <div class="flex flex-col sm:flex-row justify-center sm:justify-between items-center gap-4 mb-6">
    <h1 class="text-3xl font-bold text-gray-800">Événements à venir</h1>

    <!-- Bouton pour basculer entre liste et calendrier -->
    <mat-button-toggle-group [value]="displayMode()" (change)="toggleDisplayMode()">
      <mat-button-toggle value="list">
        <mat-icon>view_list</mat-icon>
        <span class="hidden sm:inline-block ml-2">Liste</span>
      </mat-button-toggle>
      <mat-button-toggle value="calendar">
        <mat-icon>calendar_today</mat-icon>
        <span class="hidden sm:inline-block ml-2">Calendrier</span>
      </mat-button-toggle>
    </mat-button-toggle-group>
  </div>

  <!-- Vue Liste -->
  @if (displayMode() === 'list') { @if (events().length === 0) {
  <div class="text-center text-gray-500 mt-10">
    <p>Pas d'événements à venir.</p>
  </div>
  } @else { @for (event of events(); track event.id) {
  <mat-card class="mb-4">
    <mat-card-header>
      <mat-card-title>{{ event.name }}</mat-card-title>
      <mat-card-subtitle>{{ event.start_date | date : "d MMMM y 'à' HH:mm" : '' : 'fr' }}</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <p>{{ event.description }}</p>
      <p class="text-sm text-gray-600 mt-2">Places disponibles : {{ event.available_slots }}</p>
    </mat-card-content>
    <mat-card-actions align="end">
      <a mat-raised-button color="primary" [routerLink]="['/register', event.uuid]">S'inscrire</a>
    </mat-card-actions>
  </mat-card>
  } } }

  <!-- Vue Calendrier -->
  @if (displayMode() === 'calendar') {
  <div class="flex flex-col md:flex-row justify-between items-center gap-2 mb-4 text-center">
    <div class="w-full md:w-auto flex justify-center">
      <div role="group">
        <button
          mat-stroked-button
          mwlCalendarPreviousView
          [view]="view"
          [(viewDate)]="viewDate"
          (viewDateChange)="closeOpenMonthViewDay()"
        >
          Précédent
        </button>
        <button mat-stroked-button mwlCalendarToday [(viewDate)]="viewDate">Aujourd'hui</button>
        <button
          mat-stroked-button
          mwlCalendarNextView
          [view]="view"
          [(viewDate)]="viewDate"
          (viewDateChange)="closeOpenMonthViewDay()"
        >
          Suivant
        </button>
      </div>
    </div>
    <div class="w-full md:w-auto my-2 md:my-0">
      <h3>{{ viewDate | calendarDate : view + 'ViewTitle' : 'fr' }}</h3>
    </div>
    <div class="w-full md:w-auto">
      <div role="group">
        <button
          mat-stroked-button
          (click)="setView(CalendarView.Month)"
          [class.active]="view === CalendarView.Month"
        >
          Mois
        </button>
        <button
          mat-stroked-button
          (click)="setView(CalendarView.Week)"
          [class.active]="view === CalendarView.Week"
        >
          Semaine
        </button>
        <button
          mat-stroked-button
          (click)="setView(CalendarView.Day)"
          [class.active]="view === CalendarView.Day"
        >
          Jour
        </button>
      </div>
    </div>
  </div>

  <!-- Vues du calendrier -->
  <div class="calendar-container">
    @switch (view) { @case (CalendarView.Month) {
    <mwl-calendar-month-view
      [viewDate]="viewDate"
      [events]="calendarEvents()"
      [refresh]="refresh"
      [activeDayIsOpen]="activeDayIsOpen"
      (dayClicked)="dayClicked($event.day)"
      (eventClicked)="handleEvent('Cliqué', $event.event)"
    />
    } @case (CalendarView.Week) {
    <mwl-calendar-week-view
      [viewDate]="viewDate"
      [events]="calendarEvents()"
      [refresh]="refresh"
      (eventClicked)="handleEvent('Cliqué', $event.event)"
    />
    } @case (CalendarView.Day) {
    <mwl-calendar-day-view
      [viewDate]="viewDate"
      [events]="calendarEvents()"
      [refresh]="refresh"
      (eventClicked)="handleEvent('Cliqué', $event.event)"
    />
    } }
  </div>
  }
</div>
